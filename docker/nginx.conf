# nginx가 요청을 넘길 백엔드 서버 그룹(로드밸런싱)
upstream chat-service {
    ip_hash;  # 같은 클라이언트는 같은 서버로(클라이언트 IP를 해시)
    server chat-service-1:8080;
    server chat-service-2:8080;
    server chat-service-3:8080;
}

server {
    listen 80;

    location / {
        proxy_pass http://chat-service; # upstream 그룹으로 프록시(전달)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr; # 실제 클라이언트 IP
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; # 거쳐온 IP 헤더

        # WebSocket 지원 (STOMP 때문에 필요)
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}